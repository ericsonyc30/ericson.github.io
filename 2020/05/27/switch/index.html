<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="问题诞生在一次代码review中，被老板喷了下为啥用switch而不用if；对此有点疑惑，当时的理由是：写switch会遗漏break，导致代码出现异常逻辑；当使用switch时，若break漏写的确会导致代码逻辑错误；但这理由并不充分，那么switch到底有啥优点呢？ 下面我们探寻下switch的原理！">
<meta property="og:type" content="article">
<meta property="og:title" content="Switch关键字理解">
<meta property="og:url" content="http://yoursite.com/2020/05/27/switch/index.html">
<meta property="og:site_name" content="Ericson博客">
<meta property="og:description" content="问题诞生在一次代码review中，被老板喷了下为啥用switch而不用if；对此有点疑惑，当时的理由是：写switch会遗漏break，导致代码出现异常逻辑；当使用switch时，若break漏写的确会导致代码逻辑错误；但这理由并不充分，那么switch到底有啥优点呢？ 下面我们探寻下switch的原理！">
<meta property="article:published_time" content="2020-05-26T16:20:49.000Z">
<meta property="article:modified_time" content="2020-05-26T16:20:49.850Z">
<meta property="article:author" content="ericson (杨晨)">
<meta property="article:tag" content="switch">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/2020/05/27/switch/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>Switch关键字理解 | Ericson博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Ericson博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">每天努力一点点</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/27/switch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ericson1.jpg">
      <meta itemprop="name" content="ericson (杨晨)">
      <meta itemprop="description" content="道为术之灵，术为道之体；以道统术，以术得道；">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ericson博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Switch关键字理解
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-27 00:20:49" itemprop="dateCreated datePublished" datetime="2020-05-27T00:20:49+08:00">2020-05-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" itemprop="url" rel="index"><span itemprop="name">基础知识</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="问题诞生"><a href="#问题诞生" class="headerlink" title="问题诞生"></a>问题诞生</h2><p>在一次代码review中，被老板喷了下为啥用switch而不用if；对此有点疑惑，当时的理由是：写switch会遗漏break，导致代码出现异常逻辑；当使用switch时，若break漏写的确会导致代码逻辑错误；但这理由并不充分，那么switch到底有啥优点呢？</p>
<p>下面我们探寻下switch的原理！</p>
<a id="more"></a>

<h2 id="Switch用法"><a href="#Switch用法" class="headerlink" title="Switch用法"></a>Switch用法</h2><p>二话不说，先上代码：以java为例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> type = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">switch</span> (type) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">    System.out.println(<span class="string">"1"</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">    System.out.println(<span class="string">"2"</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">    System.out.println(<span class="string">"3"</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">    System.out.println(<span class="string">"4"</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">    System.out.println(<span class="string">"5"</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    System.out.println(<span class="string">"default"</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>switch用于条件选择，分支逻辑；switch接受基本类型：int，char，enum，short等，此外还支持String类型。</p>
<p>先查看下上述代码的字节码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">Code:</span><br><span class="line">     stack=<span class="number">2</span>, locals=<span class="number">2</span>, args_size=<span class="number">1</span></span><br><span class="line">        <span class="number">0</span>: iconst_4</span><br><span class="line">        <span class="number">1</span>: istore_1</span><br><span class="line">        <span class="number">2</span>: iload_1</span><br><span class="line">        <span class="number">3</span>: tableswitch   &#123; <span class="comment">// 1 to 5</span></span><br><span class="line">                      <span class="number">1</span>: <span class="number">36</span></span><br><span class="line">                      <span class="number">2</span>: <span class="number">47</span></span><br><span class="line">                      <span class="number">3</span>: <span class="number">58</span></span><br><span class="line">                      <span class="number">4</span>: <span class="number">69</span></span><br><span class="line">                      <span class="number">5</span>: <span class="number">80</span></span><br><span class="line">                <span class="keyword">default</span>: <span class="number">91</span></span><br><span class="line">           &#125;</span><br><span class="line">       36: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">       39: ldc           #3                  // String 1</span><br><span class="line">       41: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">       <span class="number">44</span>: goto          <span class="number">99</span></span><br><span class="line">       47: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">       50: ldc           #5                  // String 2</span><br><span class="line">       52: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">       <span class="number">55</span>: goto          <span class="number">99</span></span><br><span class="line">       58: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">       61: ldc           #6                  // String 3</span><br><span class="line">       63: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">       <span class="number">66</span>: goto          <span class="number">99</span></span><br><span class="line">       69: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">       72: ldc           #7                  // String 4</span><br><span class="line">       74: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">       <span class="number">77</span>: goto          <span class="number">99</span></span><br><span class="line">       80: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">       83: ldc           #8                  // String 5</span><br><span class="line">       85: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">       <span class="number">88</span>: goto          <span class="number">99</span></span><br><span class="line">       91: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">       94: ldc           #9                  // String default</span><br><span class="line">       96: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">       <span class="number">99</span>: <span class="keyword">return</span></span><br><span class="line">     LineNumberTable:</span><br><span class="line">       line <span class="number">9</span>: <span class="number">0</span></span><br><span class="line">       line <span class="number">10</span>: <span class="number">2</span></span><br><span class="line">       line <span class="number">12</span>: <span class="number">36</span></span><br><span class="line">       line <span class="number">13</span>: <span class="number">44</span></span><br><span class="line">       line <span class="number">15</span>: <span class="number">47</span></span><br><span class="line">       line <span class="number">16</span>: <span class="number">55</span></span><br><span class="line">       line <span class="number">18</span>: <span class="number">58</span></span><br><span class="line">       line <span class="number">19</span>: <span class="number">66</span></span><br><span class="line">       line <span class="number">21</span>: <span class="number">69</span></span><br><span class="line">       line <span class="number">22</span>: <span class="number">77</span></span><br><span class="line">       line <span class="number">24</span>: <span class="number">80</span></span><br><span class="line">       line <span class="number">25</span>: <span class="number">88</span></span><br><span class="line">       line <span class="number">27</span>: <span class="number">91</span></span><br><span class="line">       line <span class="number">30</span>: <span class="number">99</span></span><br></pre></td></tr></table></figure>

<p>从上述字节码可以看出，int类型的switch变成了<code>tableswitch</code>的一张表；运行时，直接从表中查找跳转地址，查询时间O(1)。</p>
<p>下面再看看String类型的switch代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">String type = <span class="string">"love"</span>;</span><br><span class="line"><span class="keyword">switch</span> (type) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">"the"</span>:</span><br><span class="line">    System.out.println(<span class="string">"1"</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">"auto"</span>:</span><br><span class="line">    System.out.println(<span class="string">"2"</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">"hello"</span>:</span><br><span class="line">    System.out.println(<span class="string">"3"</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">"world"</span>:</span><br><span class="line">    System.out.println(<span class="string">"4"</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">"love"</span>:</span><br><span class="line">    System.out.println(<span class="string">"5"</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    System.out.println(<span class="string">"default"</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>字符串类型的switch的字节码又是咋样的呢？如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">Code:</span><br><span class="line">  stack=<span class="number">2</span>, locals=<span class="number">4</span>, args_size=<span class="number">1</span></span><br><span class="line">     0: ldc           #2                  // String love</span><br><span class="line">     <span class="number">2</span>: astore_1</span><br><span class="line">     <span class="number">3</span>: aload_1</span><br><span class="line">     <span class="number">4</span>: astore_2</span><br><span class="line">     <span class="number">5</span>: iconst_m1</span><br><span class="line">     <span class="number">6</span>: istore_3</span><br><span class="line">     <span class="number">7</span>: aload_2</span><br><span class="line">     8: invokevirtual #3                  // Method java/lang/String.hashCode:()I</span><br><span class="line">    <span class="number">11</span>: lookupswitch  &#123; <span class="comment">// 5</span></span><br><span class="line">              <span class="number">114801</span>: <span class="number">60</span></span><br><span class="line">             <span class="number">3005871</span>: <span class="number">74</span></span><br><span class="line">             <span class="number">3327858</span>: <span class="number">116</span></span><br><span class="line">            <span class="number">99162322</span>: <span class="number">88</span></span><br><span class="line">           <span class="number">113318802</span>: <span class="number">102</span></span><br><span class="line">             <span class="keyword">default</span>: <span class="number">127</span></span><br><span class="line">        &#125;</span><br><span class="line">    <span class="number">60</span>: aload_2</span><br><span class="line">    61: ldc           #4                  // String the</span><br><span class="line">    63: invokevirtual #5                  // Method java/lang/String.equals:(Ljava/lang/Object;)Z</span><br><span class="line">    <span class="number">66</span>: ifeq          <span class="number">127</span></span><br><span class="line">    <span class="number">69</span>: iconst_0</span><br><span class="line">    <span class="number">70</span>: istore_3</span><br><span class="line">    <span class="number">71</span>: goto          <span class="number">127</span></span><br><span class="line">    <span class="number">74</span>: aload_2</span><br><span class="line">    75: ldc           #6                  // String auto</span><br><span class="line">    77: invokevirtual #5                  // Method java/lang/String.equals:(Ljava/lang/Object;)Z</span><br><span class="line">    <span class="number">80</span>: ifeq          <span class="number">127</span></span><br><span class="line">    <span class="number">83</span>: iconst_1</span><br><span class="line">    <span class="number">84</span>: istore_3</span><br><span class="line">    <span class="number">85</span>: goto          <span class="number">127</span></span><br><span class="line">    <span class="number">88</span>: aload_2</span><br><span class="line">    89: ldc           #7                  // String hello</span><br><span class="line">    91: invokevirtual #5                  // Method java/lang/String.equals:(Ljava/lang/Object;)Z</span><br><span class="line">    <span class="number">94</span>: ifeq          <span class="number">127</span></span><br><span class="line">    <span class="number">97</span>: iconst_2</span><br><span class="line">    <span class="number">98</span>: istore_3</span><br><span class="line">    <span class="number">99</span>: goto          <span class="number">127</span></span><br><span class="line">   <span class="number">102</span>: aload_2</span><br><span class="line">   103: ldc           #8                  // String world</span><br><span class="line">   105: invokevirtual #5                  // Method java/lang/String.equals:(Ljava/lang/Object;)Z</span><br><span class="line">   <span class="number">108</span>: ifeq          <span class="number">127</span></span><br><span class="line">   <span class="number">111</span>: iconst_3</span><br><span class="line">   <span class="number">112</span>: istore_3</span><br><span class="line">   <span class="number">113</span>: goto          <span class="number">127</span></span><br><span class="line">   <span class="number">116</span>: aload_2</span><br><span class="line">   117: ldc           #2                  // String love</span><br><span class="line">   119: invokevirtual #5                  // Method java/lang/String.equals:(Ljava/lang/Object;)Z</span><br><span class="line">   <span class="number">122</span>: ifeq          <span class="number">127</span></span><br><span class="line">   <span class="number">125</span>: iconst_4</span><br><span class="line">   <span class="number">126</span>: istore_3</span><br><span class="line">   <span class="number">127</span>: iload_3</span><br><span class="line">   <span class="number">128</span>: tableswitch   &#123; <span class="comment">// 0 to 4</span></span><br><span class="line">                   <span class="number">0</span>: <span class="number">164</span></span><br><span class="line">                   <span class="number">1</span>: <span class="number">175</span></span><br><span class="line">                   <span class="number">2</span>: <span class="number">186</span></span><br><span class="line">                   <span class="number">3</span>: <span class="number">197</span></span><br><span class="line">                   <span class="number">4</span>: <span class="number">208</span></span><br><span class="line">             <span class="keyword">default</span>: <span class="number">219</span></span><br><span class="line">        &#125;</span><br><span class="line">   164: getstatic     #9                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">   167: ldc           #10                 // String 1</span><br><span class="line">   169: invokevirtual #11                 // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">   <span class="number">172</span>: goto          <span class="number">227</span></span><br><span class="line">   175: getstatic     #9                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">   178: ldc           #12                 // String 2</span><br><span class="line">   180: invokevirtual #11                 // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">   <span class="number">183</span>: goto          <span class="number">227</span></span><br><span class="line">   186: getstatic     #9                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">   189: ldc           #13                 // String 3</span><br><span class="line">   191: invokevirtual #11                 // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">   <span class="number">194</span>: goto          <span class="number">227</span></span><br><span class="line">   197: getstatic     #9                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">   200: ldc           #14                 // String 4</span><br><span class="line">   202: invokevirtual #11                 // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">   <span class="number">205</span>: goto          <span class="number">227</span></span><br><span class="line">   208: getstatic     #9                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">   211: ldc           #15                 // String 5</span><br><span class="line">   213: invokevirtual #11                 // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">   <span class="number">216</span>: goto          <span class="number">227</span></span><br><span class="line">   219: getstatic     #9                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">   222: ldc           #16                 // String default</span><br><span class="line">   224: invokevirtual #11                 // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">   <span class="number">227</span>: <span class="keyword">return</span></span><br><span class="line">  LineNumberTable:</span><br><span class="line">    line <span class="number">9</span>: <span class="number">0</span></span><br><span class="line">    line <span class="number">10</span>: <span class="number">3</span></span><br><span class="line">    line <span class="number">12</span>: <span class="number">164</span></span><br><span class="line">    line <span class="number">13</span>: <span class="number">172</span></span><br><span class="line">    line <span class="number">15</span>: <span class="number">175</span></span><br><span class="line">    line <span class="number">16</span>: <span class="number">183</span></span><br><span class="line">    line <span class="number">18</span>: <span class="number">186</span></span><br><span class="line">    line <span class="number">19</span>: <span class="number">194</span></span><br><span class="line">    line <span class="number">21</span>: <span class="number">197</span></span><br><span class="line">    line <span class="number">22</span>: <span class="number">205</span></span><br><span class="line">    line <span class="number">24</span>: <span class="number">208</span></span><br><span class="line">    line <span class="number">25</span>: <span class="number">216</span></span><br><span class="line">    line <span class="number">27</span>: <span class="number">219</span></span><br><span class="line">    line <span class="number">30</span>: <span class="number">227</span></span><br></pre></td></tr></table></figure>

<p>从上面看出来，String的switch使用了<code>tableswitch</code>和<code>lookupswitch</code>两种表；我们来分析下这段字节码，其实做了下面几件事：</p>
<ul>
<li>JVM先创建tableswitch，用索引来表示真正执行的代码；</li>
<li>然后根据String的hashCode生成lookupswitch，key为hashCode，value为偏移量，主要用于跳转到tableswitch；</li>
</ul>
<blockquote>
<p>当一个String进入时，会在lookup中进行比较，时间复杂度为O(n)；然后tableswitch的时间复杂度为O(1)；整体的复杂度为O(n)。</p>
</blockquote>
<p><strong>那什么时候用tableswitch，什么时候用lookupswitch呢？？？</strong></p>
<p>首先看下官方的介绍：</p>
<blockquote>
<p>Where the cases of the switch are sparse, the table representation of the tableswitch instruction becomes inefficient in terms of space. The lookupswitch instruction may be used instead. The lookupswitch instruction pairs int keys (the values of the case labels) with target offsets in a table. When a lookupswitch instruction is executed, the value of the expression of the switch is compared against the keys in the table. If one of the keys matches the value of the expression, execution continues at the associated target offset. If no key matches, execution continues at the default target.</p>
</blockquote>
<p>用中文翻译下就是：</p>
<p>当switch中case的值可以被表示为一个表中的索引值时，则使用tableswitch，比如：1，2，3，4这样的；当case的值非常稀疏，那用tableswitch做索引值时，会耗费大量的空间；所以lookupswitch的做法是：把case的int值和偏移量作为一对放在一个表里。</p>
<p>switch的问题解决了，还有一个问题，它比if有没有啥优点？？？</p>
<p>先上if的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> type = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">if</span> (type == <span class="number">1</span>) &#123;</span><br><span class="line">  System.out.println(<span class="string">"1"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (type == <span class="number">2</span>) &#123;</span><br><span class="line">  System.out.println(<span class="string">"2"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (type == <span class="number">3</span>) &#123;</span><br><span class="line">  System.out.println(<span class="string">"3"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (type == <span class="number">4</span>) &#123;</span><br><span class="line">  System.out.println(<span class="string">"4"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (type == <span class="number">5</span>) &#123;</span><br><span class="line">  System.out.println(<span class="string">"5"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  System.out.println(<span class="string">"default"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>java字节码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">2</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: iconst_5</span><br><span class="line">         <span class="number">1</span>: istore_1</span><br><span class="line">         <span class="number">2</span>: iload_1</span><br><span class="line">         <span class="number">3</span>: iconst_1</span><br><span class="line">         <span class="number">4</span>: if_icmpne     <span class="number">18</span></span><br><span class="line">         7: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">        10: ldc           #3                  // String 1</span><br><span class="line">        12: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">        <span class="number">15</span>: goto          <span class="number">90</span></span><br><span class="line">        <span class="number">18</span>: iload_1</span><br><span class="line">        <span class="number">19</span>: iconst_2</span><br><span class="line">        <span class="number">20</span>: if_icmpne     <span class="number">34</span></span><br><span class="line">        23: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">        26: ldc           #5                  // String 2</span><br><span class="line">        28: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">        <span class="number">31</span>: goto          <span class="number">90</span></span><br><span class="line">        <span class="number">34</span>: iload_1</span><br><span class="line">        <span class="number">35</span>: iconst_3</span><br><span class="line">        <span class="number">36</span>: if_icmpne     <span class="number">50</span></span><br><span class="line">        39: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">        42: ldc           #6                  // String 3</span><br><span class="line">        44: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">        <span class="number">47</span>: goto          <span class="number">90</span></span><br><span class="line">        <span class="number">50</span>: iload_1</span><br><span class="line">        <span class="number">51</span>: iconst_4</span><br><span class="line">        <span class="number">52</span>: if_icmpne     <span class="number">66</span></span><br><span class="line">        55: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">        58: ldc           #7                  // String 4</span><br><span class="line">        60: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">        <span class="number">63</span>: goto          <span class="number">90</span></span><br><span class="line">        <span class="number">66</span>: iload_1</span><br><span class="line">        <span class="number">67</span>: iconst_5</span><br><span class="line">        <span class="number">68</span>: if_icmpne     <span class="number">82</span></span><br><span class="line">        71: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">        74: ldc           #8                  // String 5</span><br><span class="line">        76: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">        <span class="number">79</span>: goto          <span class="number">90</span></span><br><span class="line">        82: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">        85: ldc           #9                  // String default</span><br><span class="line">        87: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">        <span class="number">90</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">9</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">10</span>: <span class="number">2</span></span><br><span class="line">        line <span class="number">11</span>: <span class="number">7</span></span><br><span class="line">        line <span class="number">12</span>: <span class="number">18</span></span><br><span class="line">        line <span class="number">13</span>: <span class="number">23</span></span><br><span class="line">        line <span class="number">14</span>: <span class="number">34</span></span><br><span class="line">        line <span class="number">15</span>: <span class="number">39</span></span><br><span class="line">        line <span class="number">16</span>: <span class="number">50</span></span><br><span class="line">        line <span class="number">17</span>: <span class="number">55</span></span><br><span class="line">        line <span class="number">18</span>: <span class="number">66</span></span><br><span class="line">        line <span class="number">19</span>: <span class="number">71</span></span><br><span class="line">        line <span class="number">21</span>: <span class="number">82</span></span><br><span class="line">        line <span class="number">23</span>: <span class="number">90</span></span><br></pre></td></tr></table></figure>

<p>相比于相应的switch代码，if代码每次都会加载下条件，而switch只是第一次加载条件；因此，理论上switch比if快。</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>本文还有几个待解决的问题：</p>
<p>（1）tableswitch和lookupswitch内部如何实现的？跳表，需要深入研究下；</p>
<p>（2）当代码中条件特别多的时候，代码会出现大量的分支，应该如何减少if或者switch代码？</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>[1] Java字节码：<a href="http://gityuan.com/2015/10/24/jvm-bytecode-grammar/" target="_blank" rel="noopener">http://gityuan.com/2015/10/24/jvm-bytecode-grammar/</a></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/switch/" rel="tag"># switch</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/05/25/innodb-storage/" rel="prev" title="InnoDB存储结构理解">
      <i class="fa fa-chevron-left"></i> InnoDB存储结构理解
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#问题诞生"><span class="nav-number">1.</span> <span class="nav-text">问题诞生</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Switch用法"><span class="nav-number">2.</span> <span class="nav-text">Switch用法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#后记"><span class="nav-number">3.</span> <span class="nav-text">后记</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考"><span class="nav-number">4.</span> <span class="nav-text">参考</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ericson (杨晨)"
      src="/images/ericson1.jpg">
  <p class="site-author-name" itemprop="name">ericson (杨晨)</p>
  <div class="site-description" itemprop="description">道为术之灵，术为道之体；以道统术，以术得道；</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">7</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ericson (杨晨)</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script size="300" alpha="0.6" zIndex="-1" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-ribbon@1/canvas-ribbon.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="//cdn.jsdelivr.net/gh/theme-next/theme-next-three@1/three.min.js"></script>
    <script defer src="//cdn.jsdelivr.net/gh/theme-next/theme-next-three@latest/three-waves.min.js"></script>
    <script defer src="//cdn.jsdelivr.net/gh/theme-next/theme-next-three@latest/canvas_lines.min.js"></script>
    <script defer src="//cdn.jsdelivr.net/gh/theme-next/theme-next-three@latest/canvas_sphere.min.js"></script>


  















  

  

</body>
</html>
